<!DOCTYPE html>
<html lang="en">

<head>
    <title>Chat Widget</title>
    <style>
        .chat {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px;
            background-color: #f1f1f1;
        }
        .items{
            position: absolute;
            bottom:0;
        }
    </style>
</head>

<body>
    <div id="chat"></div>
    <div class="items">

        <input type="text" id="messageInput" placeholder="Type your message here...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        // Dummy data for testing
        const conversationId = 10;
        const userId = 5;
        const customerId = 3;

        // Function to add a new chat message to the UI
        function addChatMessage(content, user) {
            const chatDiv = document.getElementById('chat');
            const newChatMessage = document.createElement('div');
            newChatMessage.classList.add('chat');
            newChatMessage.innerHTML = `<strong>${user}: </strong>${content}`;
            chatDiv.appendChild(newChatMessage);
        }
        // const socketUrl = `wss://https://django-andromedia-api-a0c055964407.herokuapp.com/ws/chat/${conversationId}/`
    const socketUrl = `wss://api.andromedia.cc/ws/chat/${conversationId}/`;

        // Function to send a message to the server via WebSocket
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const messageContent = messageInput.value.trim();
            if (messageContent) {
                // Replace 'ws://your-server-url' with your WebSocket server URL
                const socket = new WebSocket(socketUrl);

                // Event listener for WebSocket connection open
                socket.addEventListener('open', (event) => {
                    // Send the message to the server
                    const message = {
                        type: 'message',
                        message: messageContent,
                        conversation: conversationId,
                        sender_id: conversationId,
                        receiver_id:userId,
                        sender_type: "customer",
                        receiver_type:"user"
                    };
                    const message2 = {
                        type: 'typing',
                        sender_type: "user",
                        conversation: "10"
                    }
                    socket.send(JSON.stringify(message));
                });

                // Event listener for WebSocket message received
                socket.addEventListener('message', (event) => {
                    const message = JSON.parse(event.data);
                    console.log(message, event.data)
                    if (message.type === 'message') {
                        messageItem = JSON.parse(message.message);
                        console.log(messageItem)
                        addChatMessage(messageItem.message, 'User');
                    }
                });

                // Clear the message input after sending
                messageInput.value = '';
            }
        }

        // Simulate receiving a message from the server
        function receiveMessage(messageContent) {
            addChatMessage(messageContent, messageContent.sender_type);
        }

        // Dummy data to simulate receiving a message from the server
        receiveMessage("Hello, how are you?");

        // Listen for Enter key press to send a message
        document.getElementById('messageInput').addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>

</html>
